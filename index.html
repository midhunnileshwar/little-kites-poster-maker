<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KITE Kasaragod Poster Generator</title>
    
    <!-- Cropper.js (Used only for touch gestures, grid hidden) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    
    <!-- Google Fonts: Manjari (Malayalam) & Roboto -->
    <link href="https://fonts.googleapis.com/css2?family=Manjari:wght@400;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- THEME COLORS (KITE BRANDING) --- */
        :root {
            --kite-teal: #00897b;
            --kite-dark: #004d40;
            --kite-orange: #ff6f00;
            --bg-color: #f5f7fa;
            --white: #ffffff;
        }

        body {
            font-family: 'Roboto', 'Manjari', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* --- ATTRACTIVE HEADER --- */
        header {
            background: linear-gradient(135deg, var(--kite-teal), var(--kite-dark));
            width: 100%;
            padding: 30px 20px;
            text-align: center;
            color: var(--white);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: -40px; /* Overlap effect */
            padding-bottom: 60px;
        }

        h1 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        p.subtitle {
            margin-top: 8px;
            opacity: 0.9;
            font-size: 0.95rem;
        }

        /* --- MAIN CARD --- */
        .container {
            width: 90%;
            max-width: 420px;
            z-index: 10;
        }

        .card {
            background: var(--white);
            border-radius: 20px;
            padding: 30px 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        /* --- INPUT FIELDS --- */
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }

        label {
            display: block;
            color: #555;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input[type="text"] {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 1rem;
            transition: border-color 0.3s;
            box-sizing: border-box;
            font-family: inherit;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--kite-teal);
        }

        /* --- BUTTONS --- */
        .btn-main {
            background-color: var(--kite-teal);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 50px;
            width: 100%;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 137, 123, 0.3);
            transition: transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-main:active { transform: scale(0.98); }

        .btn-download {
            background-color: var(--kite-orange);
            text-decoration: none;
            display: inline-block;
            margin-top: 15px;
        }

        /* --- RESULT AREA --- */
        #resultArea {
            display: none;
            margin-top: 20px;
            animation: fadeIn 0.5s ease;
        }

        canvas {
            width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            border: 4px solid white;
        }

        /* --- FOOTER --- */
        footer {
            margin-top: auto;
            padding: 20px;
            text-align: center;
            color: #777;
            font-size: 0.8rem;
        }
        
        .developer-credit {
            color: var(--kite-teal);
            font-weight: bold;
        }

        /* --- HIDDEN FILE INPUT --- */
        input[type="file"] { display: none; }

        /* --- PHOTO ADJUSTMENT MODAL (Full Screen) --- */
        #photoModal {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #111;
            z-index: 2000;
            display: none;
            flex-direction: column;
        }

        .modal-header {
            color: white;
            text-align: center;
            padding: 15px;
            background: rgba(0,0,0,0.5);
            font-size: 0.9rem;
            z-index: 20;
        }

        .modal-body {
            flex: 1;
            position: relative;
            background: #000;
            overflow: hidden;
        }

        /* The Template Overlay in the Editor */
        .overlay-preview {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none; /* Let touches pass through to image */
            background-image: url('template.png'); 
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.8; /* Make it slightly see-through so they can align */
        }

        .modal-footer {
            padding: 20px;
            background: #111;
            display: flex;
            gap: 15px;
            z-index: 20;
        }

        .btn-cancel { background: #444; color: white; border: none; padding: 15px; border-radius: 10px; flex: 1; font-weight: bold; cursor:pointer;}
        .btn-confirm { background: var(--kite-teal); color: white; border: none; padding: 15px; border-radius: 10px; flex: 1; font-weight: bold; cursor:pointer;}

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <h1>Little KITES Selection</h1>
        <p class="subtitle">Create your congratulatory poster instantly</p>
    </header>

    <!-- Main Content -->
    <div class="container">
        
        <!-- Input Form -->
        <div class="card" id="inputForm">
            <div class="input-group">
                <label>Student Name</label>
                <input type="text" id="nameInput" placeholder="Enter Name (Malayalam or English)">
            </div>

            <div class="input-group">
                <label>School Name</label>
                <input type="text" id="schoolInput" placeholder="Enter School Name">
            </div>

            <label for="fileInput" class="btn-main">
                <span>ðŸ“· Tap to Upload Photo</span>
            </label>
            <input type="file" id="fileInput" accept="image/*">
        </div>

        <!-- Final Result Display -->
        <div id="resultArea" class="card">
            <h3 style="margin-top:0; color:var(--kite-dark)">Poster Ready!</h3>
            <canvas id="finalCanvas"></canvas>
            
            <a id="downloadBtn" class="btn-main btn-download">Download Image ðŸ“¥</a>
            
            <button onclick="location.reload()" style="background:none; border:none; color:#777; text-decoration:underline; margin-top:15px; cursor:pointer;">
                Create New
            </button>
        </div>

    </div>

    <!-- Footer -->
    <footer>
        Developed by <span class="developer-credit">KITE Kasaragod</span>
    </footer>

    <!-- Photo Adjustment Modal -->
    <div id="photoModal">
        <div class="modal-header">
            Drag & Pinch photo to fit in the circle
        </div>
        <div class="modal-body">
            <!-- The User Image -->
            <img id="imageToEdit" src="" style="max-width:100%; display:block;">
            <!-- The Template Overlay -->
            <div class="overlay-preview"></div>
        </div>
        <div class="modal-footer">
            <button class="btn-cancel" onclick="closeModal()">Cancel</button>
            <button class="btn-confirm" onclick="generateFinalPoster()">Done âœ…</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    
    <script>
        // =========================================================
        // âš™ï¸ POSTER CONFIGURATION - ADJUST SETTINGS HERE
        // =========================================================
        const POSTER_CONFIG = {
            // 1. STUDENT NAME SETTINGS
name: {
    y: 1548,               // Calculated Vertical Center
    fontSize: 55,          
    color: '#004d40',      
    fontFamily: 'Manjari', 
    fontWeight: 'bold',
    textAlign: 'center',   // Ensure this is set to center the X-axis at 850
    x: 850                 // Calculated Horizontal Center
}
            },

           // 2. SCHOOL NAME SETTINGS
school: {
    x: 847.5,           // Horizontal Center
    y: 1866.5,         // Vertical Center
    fontSize: 35,
    color: '#444444',
    fontFamily: 'Manjari',
    fontWeight: 'normal',
    textAlign: 'center' // Ensure text aligns to the x-coordinate
}
        };
        // =========================================================

        // DOM Elements
        const fileInput = document.getElementById('fileInput');
        const nameInput = document.getElementById('nameInput');
        const schoolInput = document.getElementById('schoolInput');
        const photoModal = document.getElementById('photoModal');
        const imageToEdit = document.getElementById('imageToEdit');
        const inputForm = document.getElementById('inputForm');
        const resultArea = document.getElementById('resultArea');
        const finalCanvas = document.getElementById('finalCanvas');
        const downloadBtn = document.getElementById('downloadBtn');

        let cropper = null;
        let templateImg = new Image();
        
        // Load Template
        templateImg.src = 'template.png'; 

        // 1. Listen for File Upload
        fileInput.addEventListener('change', function(e) {
            // Simple Validation
            if(nameInput.value.trim() === "" || schoolInput.value.trim() === "") {
                alert("Please enter Name and School first.");
                this.value = ""; // Reset
                return;
            }

            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    imageToEdit.src = event.target.result;
                    openPhotoEditor();
                };
                reader.readAsDataURL(file);
            }
        });

        // 2. Open the "Drag & Pinch" Editor
        function openPhotoEditor() {
            photoModal.style.display = 'flex';
            
            // Wait for modal to render
            setTimeout(() => {
                if(cropper) cropper.destroy();

                cropper = new Cropper(imageToEdit, {
                    aspectRatio: templateImg.width / templateImg.height, // Match template
                    viewMode: 0, // Allow free movement
                    dragMode: 'move', // Default to dragging immediately
                    
                    // HIDE THE CROPPER VISUALS (Make it look like a preview)
                    guides: false,
                    center: false,
                    background: false,
                    highlight: false,
                    cropBoxMovable: false,
                    cropBoxResizable: false,
                    toggleDragModeOnDblclick: false,
                    autoCropArea: 1, // Fill screen
                    
                    ready() {
                        // Force the "crop box" to fill the container so user sees full image
                        this.cropper.setCropBoxData({
                            width: this.cropper.getContainerData().width,
                            height: this.cropper.getContainerData().height,
                            left: 0,
                            top: 0
                        });
                    }
                });
            }, 100);
        }

        // 3. Close Modal
        function closeModal() {
            photoModal.style.display = 'none';
            fileInput.value = "";
            if(cropper) cropper.destroy();
        }

        // 4. Generate the Final Poster
        function generateFinalPoster() {
            if (!cropper) return;

            // A. Get the user's photo (positioned correctly)
            const userPhotoCanvas = cropper.getCroppedCanvas({
                width: templateImg.width,
                height: templateImg.height,
                imageSmoothingQuality: 'high'
            });

            // B. Setup Final Canvas
            finalCanvas.width = templateImg.width;
            finalCanvas.height = templateImg.height;
            const ctx = finalCanvas.getContext('2d');

            // Layer 1: User Photo
            ctx.drawImage(userPhotoCanvas, 0, 0);

            // Layer 2: Template Overlay
            ctx.drawImage(templateImg, 0, 0);

            // Layer 3: Text
            drawTextLayer(ctx);

            // C. Show Result
            photoModal.style.display = 'none';
            inputForm.style.display = 'none'; // Hide inputs
            resultArea.style.display = 'block'; // Show poster

            // Setup Download
            downloadBtn.href = finalCanvas.toDataURL('image/png');
        }

        // Helper: Draw Text based on Config
        function drawTextLayer(ctx) {
            ctx.textAlign = 'center';
            const centerX = finalCanvas.width / 2;

            // 1. Draw Name
            ctx.font = `${POSTER_CONFIG.name.fontWeight} ${POSTER_CONFIG.name.fontSize}px '${POSTER_CONFIG.name.fontFamily}'`;
            ctx.fillStyle = POSTER_CONFIG.name.color;
            ctx.fillText(nameInput.value, centerX, POSTER_CONFIG.name.y);

            // 2. Draw School
            ctx.font = `${POSTER_CONFIG.school.fontWeight} ${POSTER_CONFIG.school.fontSize}px '${POSTER_CONFIG.school.fontFamily}'`;
            ctx.fillStyle = POSTER_CONFIG.school.color;
            ctx.fillText(schoolInput.value, centerX, POSTER_CONFIG.school.y);
        }
    </script>
</body>
</html>
